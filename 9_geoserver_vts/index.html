



<!DOCTYPE html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="es">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-3.0.4">
    
    
      
        <title>9. Servir vector tiles desde GeoServer - Trabajando con VT</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
      
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="../#servir-vector-tiles-desde-geoserver" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Trabajando con VT" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Trabajando con VT
              </span>
              <span class="md-header-nav__topic">
                9. Servir vector tiles desde GeoServer
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/geoinquiets/taller-vt/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Trabajando con VT" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Trabajando con VT
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/geoinquiets/taller-vt/" title="Ir al repositorio" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#__github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../1_teoria/" title="1. Qué son" class="md-nav__link">
      1. Qué son
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../2_visor_simple/" title="2. Cómo visualizarlas" class="md-nav__link">
      2. Cómo visualizarlas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../3_tileserver_gl/" title="3. Cómo servirlas" class="md-nav__link">
      3. Cómo servirlas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../4_tippecanoe/" title="4. Cómo crearlas" class="md-nav__link">
      4. Cómo crearlas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../5_sprites_glyphs/" title="5. Sprites y Glyphs" class="md-nav__link">
      5. Sprites y Glyphs
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../6_estilos/" title="6. Cómo simbolizarlas" class="md-nav__link">
      6. Cómo simbolizarlas
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../7_servidor_dinamico/" title="7. Cómo servir datos dinámicos" class="md-nav__link">
      7. Cómo servir datos dinámicos
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../8_postgis_vt/" title="8. Cómo servir datos desde PostGIS" class="md-nav__link">
      8. Cómo servir datos desde PostGIS
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        9. Servir vector tiles desde GeoServer
      </label>
    
    <a href="./" title="9. Servir vector tiles desde GeoServer" class="md-nav__link md-nav__link--active">
      9. Servir vector tiles desde GeoServer
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#instalar-la-extension-de-vector-tiles-en-geoserver" title="Instalar la extensión de Vector Tiles en GeoServer" class="md-nav__link">
    Instalar la extensión de Vector Tiles en GeoServer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publicar-vector-tiles-en-geoserver" title="Publicar Vector Tiles en GeoServer" class="md-nav__link">
    Publicar Vector Tiles en GeoServer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publicar-las-capas-como-grupos-de-capas" title="Publicar las capas como grupos de capas" class="md-nav__link">
    Publicar las capas como grupos de capas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consumir-las-vector-tiles-publicadas-desde-geoserver" title="Consumir las vector tiles publicadas desde GeoServer" class="md-nav__link">
    Consumir las vector tiles publicadas desde GeoServer
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#instalar-la-extension-de-vector-tiles-en-geoserver" title="Instalar la extensión de Vector Tiles en GeoServer" class="md-nav__link">
    Instalar la extensión de Vector Tiles en GeoServer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publicar-vector-tiles-en-geoserver" title="Publicar Vector Tiles en GeoServer" class="md-nav__link">
    Publicar Vector Tiles en GeoServer
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#publicar-las-capas-como-grupos-de-capas" title="Publicar las capas como grupos de capas" class="md-nav__link">
    Publicar las capas como grupos de capas
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#consumir-las-vector-tiles-publicadas-desde-geoserver" title="Consumir las vector tiles publicadas desde GeoServer" class="md-nav__link">
    Consumir las vector tiles publicadas desde GeoServer
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/geoinquiets/taller-vt/edit/master/docs/9_geoserver_vts.md" title="Editar esta página" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="servir-vector-tiles-desde-geoserver">Servir vector tiles desde GeoServer</h1>
<p>GeoServer está preparado para servir teselas vectoriales en tres formatos diferentes: GeoJSON TopoJSON y las vector tiles de Mapbox. </p>
<table>
<thead>
<tr>
<th>Formato</th>
<th>MIME</th>
<th>Descripción</th>
</tr>
</thead>
<tbody>
<tr>
<td>Mapbox Vector (MVT)</td>
<td><code>application/vnd.mapbox-vector-tile</code></td>
<td><strong>Formato Recomendado</strong></td>
</tr>
<tr>
<td>GeoJSON</td>
<td><code>application/json;type=geojson</code></td>
<td>No soportado por muchos de los clientes de Vector Tiles</td>
</tr>
<tr>
<td>TopoJSON</td>
<td><code>application/json;type=topojson</code></td>
<td>Más complejo que el GeoJSON por gestionar la topología. No está soportado por muchos clientes</td>
</tr>
</tbody>
</table>
<p>GeoServer soporta Vector Tiles a través de GeoWebCache, por lo que será este el que se encargue de gestionar las capas que serán consumidas en este formato. </p>
<p>Lo primero para poder usar Vector Tiles con GeoServer será instalar la librería que le da soporte.</p>
<h2 id="instalar-la-extension-de-vector-tiles-en-geoserver">Instalar la extensión de Vector Tiles en GeoServer</h2>
<p>Para instalar la extensión de GeoServer que nos permita usar vector tiles lo primero que haremos será descargar la librería de la versión de geoserver que estemos utilizando (para este ejemplo es la versión 2.14.4):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>wget http://sourceforge.net/projects/geoserver/files/GeoServer/2.14.4/extensions/geoserver-2.14.4-vectortiles-plugin.zip
</pre></div>
</td></tr></table>

<p>Extraeremos el contenido del archivo en la carpeta <code>WEB-INF-lib</code> de nuestra instalación de GeoServer</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>unzip geoserver-2.14.4-vectortiles-plugin.zip -d <span class="nv">$GEOSERVER_DIR</span>/WEB-INF/lib/
</pre></div>
</td></tr></table>

<p>Reiniciaremos nuestro GeoServer y ya tendríamos la extensión instalada.</p>
<p>Para comprobar que la extensión se ha instalado correctamente iremos al administrador web de GeoServer y seleccionaremos una capa de tipo vectorial, navegaremos hasta la pestaña de <code>Tile Caching</code> y comprobaremos que aparecen las opciones:</p>
<ul>
<li><code>application/json;type=geojson</code></li>
<li><code>application/json;type=topojson</code></li>
<li><code>application/vnd.mapbox-vector-tile</code></li>
</ul>
<p><img alt="" src="../img/vectortiles_geoserver_1.gif" /></p>
<h2 id="publicar-vector-tiles-en-geoserver">Publicar Vector Tiles en GeoServer</h2>
<p>Para publicar una capa vectorial como vector tiles simplemente seleccionaremos una capa de tipo vectorial que queramos publicar y seleccionaremos en la opción de <code>Tile Caching</code> cualquiera de los formatos de vector tiles que están disponibles. Se recomienda el uso de <code>application/vnd.mapbox-vector-tile</code></p>
<p>En nuestro ejemplo de la base de datos <code>bcn_geodata</code> publicaremos la capa de <em>secciones censales</em></p>
<p><img alt="" src="../img/publish_vectortiles_geoserver.gif" /></p>
<p>Una vez que tengamos la capa publicada podremos comprobar que esta se ha cacheado simplemente accediendo a la instancia de <code>GeoWebCache</code> instalada junto a nuestro GeoServer. En la web de administración de GeoServer seleccionaremos la sección de <code>Tile Caching</code>, <code>Tile Layers</code> y deberíamos encontrar un listado de las capas que tenemos publicadas y cacheadas.</p>
<p><img alt="" src="../img/tile_layers.gif" /></p>
<p>Desde la sección de <code>Preview</code> de cada capa tendremos la opción de visualizar los datos en formato <code>pbf</code> que es el formato de transferencia de las <code>Vector Tiles</code></p>
<p><img alt="" src="../img/format_pbf.gif" /></p>
<p>Si seleccionamos uno de estos formatos accederemos al visor de GeoWebCache donde visualizaremos la capa.</p>
<h2 id="publicar-las-capas-como-grupos-de-capas">Publicar las capas como grupos de capas</h2>
<p>Como ya se ha comentado a lo largo del tutorial, el formato de vector tiles nos permite enviar información de diferentes capas en una misma tesela. Para realizar esto con GeoServer, tendremos que generar un grupo de capas con los datos que nos interese y publicarlos de la misma manera que las capas anteriores.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Todas las capas que formen el grupo de capas deberán estar publicadas con el formato de vector tiles que queramos usar. En nuestro caso <code>application/vnd.mapbox-vector-tile</code></p>
</div>
<p><img alt="" src="../img/bcn_geodata_layer_group.gif" /></p>
<h2 id="consumir-las-vector-tiles-publicadas-desde-geoserver">Consumir las vector tiles publicadas desde GeoServer</h2>
<p>Para consumir las vector tiles que tenemos publicadas en nuestro GeoServer, en este caso, definiremos un estilo con las capas publicadas como <code>source-layer</code> mientras que el <code>source</code> de los datos será la URL de nuestro GeoWebCache donde está publicada el grupo de capas. El estilo lo guardaremos como <code>vectortiles-geoserver.json</code> dentro de la carpeta <code>resultado/vectortiles</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;VectorTiles GeoServer&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;vectortiles-geoserver&quot;</span><span class="p">,</span>
  <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;mapbox:autocomposite&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;mapbox:type&quot;</span><span class="p">:</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span>
    <span class="nt">&quot;maputnik:renderer&quot;</span><span class="p">:</span> <span class="s2">&quot;mbgljs&quot;</span><span class="p">,</span>
    <span class="nt">&quot;openmaptiles:version&quot;</span><span class="p">:</span> <span class="s2">&quot;3.x&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;sources&quot;</span><span class="p">:</span> <span class="p">{</span>
  <span class="p">},</span>
  <span class="nt">&quot;sprite&quot;</span><span class="p">:</span> <span class="s2">&quot;https://geoserveis.icgc.cat/contextmaps/sprites/sprite@1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;glyphs&quot;</span><span class="p">:</span> <span class="s2">&quot;https://geoserveis.icgc.cat/contextmaps/glyphs/{fontstack}/{range}.pbf&quot;</span><span class="p">,</span>
  <span class="nt">&quot;layers&quot;</span><span class="p">:</span> <span class="p">[</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Lo primero que deberemos definir es el <code>source</code> de los datos. Para ello definiremos un <code>source</code> de tipo <code>vector</code>. Deberemos definir el esquema de las teselas como <code>tms</code> y la url de las teselas la url del GeoWebCache:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;VectorTiles GeoServer&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;vectortiles-geoserver&quot;</span><span class="p">,</span>
  <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;mapbox:autocomposite&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;mapbox:type&quot;</span><span class="p">:</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span>
    <span class="nt">&quot;maputnik:renderer&quot;</span><span class="p">:</span> <span class="s2">&quot;mbgljs&quot;</span><span class="p">,</span>
    <span class="nt">&quot;openmaptiles:version&quot;</span><span class="p">:</span> <span class="s2">&quot;3.x&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;sources&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="hll">    <span class="nt">&quot;bcn_geodata&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">      <span class="nt">&quot;tiles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;http://localhost:8090/geowebcache/service/tms/1.0.0/vectortiles:bcn_geodata@EPSG:900913@pbf/{z}/{x}/{y}.pbf&quot;</span><span class="p">],</span>
</span><span class="hll">      <span class="nt">&quot;scheme&quot;</span><span class="p">:</span> <span class="s2">&quot;tms&quot;</span><span class="p">,</span>
</span><span class="hll">      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vector&quot;</span>
</span>    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;sprite&quot;</span><span class="p">:</span> <span class="s2">&quot;https://geoserveis.icgc.cat/contextmaps/sprites/sprite@1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;glyphs&quot;</span><span class="p">:</span> <span class="s2">&quot;https://geoserveis.icgc.cat/contextmaps/glyphs/{fontstack}/{range}.pbf&quot;</span><span class="p">,</span>
  <span class="nt">&quot;layers&quot;</span><span class="p">:</span> <span class="p">[</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>La URL donde se están publicando las teselas se compone de la siguiente manera:</p>
<ul>
<li>URL del GeoWebCache: <code>http://localhost:8090/geoserver/gwc/</code></li>
<li>Definición del servicio <a href="https://en.wikipedia.org/wiki/Tile_Map_Service">TMS</a> <code>service/tms/1.0.0/</code></li>
<li>Definición de la capa en la manera <strong>layer@gridset@formato/{z}/{x}/{y}.pbf</strong>, <code>bcn_geodata@EPSG:900913@pbf/{z}/{x}/{y}.pbf</code></li>
</ul>
<p>Las capas las definiremos como en los ejemplos anteriores:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;version&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
  <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;VectorTiles GeoServer&quot;</span><span class="p">,</span>
  <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;vectortiles-geoserver&quot;</span><span class="p">,</span>
  <span class="nt">&quot;metadata&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;mapbox:autocomposite&quot;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nt">&quot;mapbox:type&quot;</span><span class="p">:</span> <span class="s2">&quot;template&quot;</span><span class="p">,</span>
    <span class="nt">&quot;maputnik:renderer&quot;</span><span class="p">:</span> <span class="s2">&quot;mbgljs&quot;</span><span class="p">,</span>
    <span class="nt">&quot;openmaptiles:version&quot;</span><span class="p">:</span> <span class="s2">&quot;3.x&quot;</span>
  <span class="p">},</span>
  <span class="nt">&quot;sources&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;bcn_geodata&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;tiles&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;http://localhost:8090/geowebcache/service/tms/1.0.0/vectortiles:bcn_geodata@EPSG:900913@pbf/{z}/{x}/{y}.pbf&quot;</span><span class="p">],</span>
      <span class="nt">&quot;scheme&quot;</span><span class="p">:</span> <span class="s2">&quot;tms&quot;</span><span class="p">,</span>
      <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;vector&quot;</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="nt">&quot;sprite&quot;</span><span class="p">:</span> <span class="s2">&quot;https://geoserveis.icgc.cat/contextmaps/sprites/sprite@1&quot;</span><span class="p">,</span>
  <span class="nt">&quot;glyphs&quot;</span><span class="p">:</span> <span class="s2">&quot;https://geoserveis.icgc.cat/contextmaps/glyphs/{fontstack}/{range}.pbf&quot;</span><span class="p">,</span>
  <span class="nt">&quot;layers&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;barrios&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;bcn_geodata&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="nt">&quot;source-layer&quot;</span><span class="p">:</span> <span class="s2">&quot;barrios&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="nt">&quot;layout&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">            <span class="nt">&quot;visibility&quot;</span><span class="p">:</span> <span class="s2">&quot;visible&quot;</span>
</span><span class="hll">        <span class="p">},</span>
</span><span class="hll">        <span class="nt">&quot;paint&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">            <span class="nt">&quot;fill-color&quot;</span><span class="p">:</span> <span class="s2">&quot;#ff0000&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="nt">&quot;fill-opacity&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">            <span class="nt">&quot;base&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span class="hll">            <span class="nt">&quot;stops&quot;</span><span class="p">:</span> <span class="p">[</span>
</span><span class="hll">                <span class="p">[</span>
</span><span class="hll">                    <span class="mi">9</span><span class="p">,</span>
</span><span class="hll">                    <span class="mf">0.9</span>
</span><span class="hll">                <span class="p">],</span>
</span><span class="hll">                <span class="p">[</span>
</span><span class="hll">                    <span class="mi">22</span><span class="p">,</span>
</span><span class="hll">                    <span class="mf">0.3</span>
</span><span class="hll">                <span class="p">]</span>
</span><span class="hll">            <span class="p">]</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">      <span class="p">}</span>
</span><span class="hll">    <span class="p">},</span>
</span><span class="hll">    <span class="p">{</span>
</span><span class="hll">        <span class="nt">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;seccion_censal&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="nt">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;bcn_geodata&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="nt">&quot;source-layer&quot;</span><span class="p">:</span> <span class="s2">&quot;seccion_censal&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="nt">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;fill&quot;</span><span class="p">,</span>
</span><span class="hll">        <span class="nt">&quot;paint&quot;</span><span class="p">:</span> <span class="p">{</span>
</span><span class="hll">            <span class="nt">&quot;fill-opacity&quot;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">,</span>
</span><span class="hll">            <span class="nt">&quot;fill-color&quot;</span><span class="p">:</span> <span class="s2">&quot;#fcc&quot;</span><span class="p">,</span>
</span><span class="hll">            <span class="nt">&quot;fill-outline-color&quot;</span><span class="p">:</span> <span class="s2">&quot;#000&quot;</span>
</span><span class="hll">        <span class="p">}</span>
</span><span class="hll">    <span class="p">}</span>
</span>  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Ahora construiremos un pequeño visor para consumir nuestros datos como ya hicimos en ejemplos anteriores. Para ello creamos un fichero <code>index.html</code> dentro de la carpeta <code>resultado/vectortiles</code> con el siguiente contenido:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&quot;UTF-8&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;viewport&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;width=device-width, initial-scale=1&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Mapa VT<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.css&#39;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;https://api.tiles.mapbox.com/mapbox-gl-js/v0.44.1/mapbox-gl.js&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#39;https://mapbox-gl-inspect.lukasmartinelli.ch/dist/mapbox-gl-inspect.css&#39;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#39;stylesheet&#39;</span> <span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#39;https://mapbox-gl-inspect.lukasmartinelli.ch/dist/mapbox-gl-inspect.min.js&#39;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">style</span><span class="p">&gt;</span>
        <span class="nt">html</span><span class="o">,</span> <span class="nt">body</span> <span class="p">{</span>
            <span class="k">margin</span><span class="p">:</span> <span class="mi">0</span><span class="p">;</span>
            <span class="k">height</span><span class="p">:</span> <span class="mi">100</span><span class="kt">%</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">&lt;/</span><span class="nt">style</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">body</span> <span class="na">id</span><span class="o">=</span><span class="s">&#39;map&#39;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
    <span class="kd">var</span> <span class="nx">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">Map</span><span class="p">({</span>
        <span class="nx">container</span><span class="o">:</span> <span class="s1">&#39;map&#39;</span><span class="p">,</span> <span class="c1">// id del elemento HTML que contendrá el mapa</span>
        <span class="nx">style</span><span class="o">:</span> <span class="s1">&#39;./vectortiles-geoserver.json&#39;</span><span class="p">,</span> <span class="c1">// Ubicación del estilo</span>
        <span class="nx">center</span><span class="o">:</span> <span class="p">[</span><span class="mf">2.19224</span><span class="p">,</span> <span class="mf">41.38585</span><span class="p">],</span>
        <span class="nx">zoom</span><span class="o">:</span> <span class="mi">15</span><span class="p">,</span>
        <span class="nx">bearing</span><span class="o">:</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span>
        <span class="nx">hash</span><span class="o">:</span> <span class="kc">true</span>
    <span class="p">});</span>

    <span class="c1">// Agrega controles de navegación (zoom, rotación) al mapa:</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addControl</span><span class="p">(</span><span class="k">new</span> <span class="nx">mapboxgl</span><span class="p">.</span><span class="nx">NavigationControl</span><span class="p">());</span>

    <span class="c1">// Agregar el control de inspección</span>
    <span class="nx">map</span><span class="p">.</span><span class="nx">addControl</span><span class="p">(</span><span class="k">new</span> <span class="nx">MapboxInspect</span><span class="p">());</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</pre></div>
</td></tr></table>

<p>Usaremos cualquier servidor web para publicar el contenido de la carpeta y accederemos desde nuestro navegador a la url publicada por este servidor donde visualizaremos</p>
<p><img alt="" src="../img/geoserver-vts.png" /></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../8_postgis_vt/" title="8. Cómo servir datos desde PostGIS" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                8. Cómo servir datos desde PostGIS
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.583bbe55.js"></script>
      
        
        
          
          <script src="../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
              
              
                <script src="../assets/javascripts/lunr/lunr.es.js"></script>
              
            
          
          
        
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>